<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∏—Å—Å–∏—è: –ö–∏–±–µ—Ä—â–∏—Ç | –ï—Ä–¥—é–∫–æ–≤ –Ø—Ä–æ—Å–ª–∞–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò --- */
        :root {
            --neon-blue: #00d2ff;
            --neon-green: #00ff00;
            --neon-red: #ff3333;
            --dark-bg: rgba(11, 16, 26, 0.95);
        }

        body {
            margin: 0;
            background: linear-gradient(-45deg, #141e30, #243b55, #000000, #1a2a6c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- –ò–ì–†–û–í–ê–Ø –ö–û–ù–°–û–õ–¨ --- */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1280px;
            max-height: 720px;
            background: #000;
            border: 4px solid var(--neon-blue);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 210, 255, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 768px) {
            #game-container {
                border-width: 0;
                border-radius: 0;
            }
        }

        /* –í–∏–¥–µ–æ */
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        /* –ó–∞–≥–ª—É—à–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ */
        #simulation-placeholder {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #001a33 0%, #000000 100%);
            color: var(--neon-blue);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .sim-icon { font-size: 4rem; margin-bottom: 20px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1.1); } }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–µ—Ç–∫–∏ */
        #game-container::after {
            content: " ";
            display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: repeating-linear-gradient(transparent, transparent 2px, rgba(0, 0, 0, 0.3) 3px);
            z-index: 5; pointer-events: none;
        }

        /* --- HUD --- */
        #hud-panel {
            position: absolute; top: 20px; left: 0; right: 0;
            display: flex; justify-content: space-between; padding: 0 5%;
            z-index: 20; display: none;
        }

        .hud-box {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-blue);
            padding: 8px 15px; border-radius: 10px;
            box-shadow: 0 0 10px var(--neon-blue);
            font-size: 1rem; display: flex; align-items: center; gap: 10px;
        }

        #health-track { width: 100px; height: 10px; background: #333; border-radius: 5px; overflow: hidden; }
        #health-fill { width: 100%; height: 100%; background: var(--neon-green); transition: width 0.5s, background 0.5s; }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–°–´ --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg);
            backdrop-filter: blur(8px);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; z-index: 30;
            padding: 20px; box-sizing: border-box;
            animation: fadeIn 0.5s ease;
            overflow-y: auto; /* –î–ª—è —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { font-size: clamp(1.5rem, 5vw, 3.5rem); color: var(--neon-blue); margin: 0 0 10px 0; text-shadow: 0 0 15px var(--neon-blue); }
        h2 { font-size: clamp(0.9rem, 3vw, 1.2rem); color: #ddd; margin-bottom: 20px; }

        .author-badge {
            border: 1px solid var(--neon-blue); padding: 10px;
            background: rgba(0, 210, 255, 0.05); margin-bottom: 20px;
            border-radius: 10px; font-size: 0.9rem;
        }

        /* –í–≤–æ–¥ –∏–º–µ–Ω–∏ */
        .input-group { margin-bottom: 20px; text-align: left; width: 100%; max-width: 400px; }
        .input-label { display: block; color: var(--neon-blue); margin-bottom: 5px; font-size: 0.9rem; }
        .cyber-input {
            width: 100%; padding: 15px; background: rgba(0,0,0,0.5);
            border: 2px solid var(--neon-blue); color: white;
            font-family: 'Orbitron', sans-serif; font-size: 1.2rem;
            border-radius: 5px; box-sizing: border-box; outline: none;
            transition: box-shadow 0.3s;
        }
        .cyber-input:focus { box-shadow: 0 0 15px var(--neon-blue); }

        /* –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ */
        .stats-panel {
            width: 100%; max-width: 600px;
            background: rgba(0,0,0,0.6); border: 1px solid #333;
            border-radius: 10px; padding: 15px; margin-top: 10px;
            max-height: 200px; overflow-y: auto;
        }
        .stat-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid #333; font-size: 0.85rem;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-win { color: var(--neon-green); }
        .stat-fail { color: var(--neon-red); }
        .total-counter {
            display: flex; gap: 20px; margin-bottom: 20px; font-size: 0.9rem; color: #aaa;
        }

        /* –ö–Ω–æ–ø–∫–∏ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .edu-card {
            background: rgba(0, 0, 0, 0.8); border: 1px solid var(--neon-blue);
            border-left: 5px solid var(--neon-blue); padding: 20px;
            max-width: 700px; width: 90%; text-align: left; margin-bottom: 20px;
            border-radius: 10px;
        }
        .edu-title { color: #ffcc00; font-size: 1.2rem; margin-bottom: 10px; }
        .edu-text { font-size: 1rem; line-height: 1.5; color: #eee; }
        
        .feedback-correct { border-left-color: var(--neon-green); }
        .feedback-correct .edu-title { color: var(--neon-green); }
        .feedback-wrong { border-left-color: var(--neon-red); }
        .feedback-wrong .edu-title { color: var(--neon-red); }

        .btn-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .btn {
            background: linear-gradient(180deg, #00d2ff, #0077ff);
            border: none; color: white; padding: 15px 30px;
            font-size: 1.1rem; font-family: 'Orbitron', sans-serif; font-weight: bold;
            cursor: pointer; border-radius: 50px; text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3); min-width: 180px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-danger { background: linear-gradient(180deg, #ff416c, #ff4b2b); box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3); }
        .btn-next { background: linear-gradient(180deg, #11998e, #38ef7d); }

        .hidden { display: none !important; }

        /* –¢—Ä–µ–≤–æ–≥–∞ */
        .alert-popup {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            background: rgba(220, 0, 0, 0.9); border: 2px solid #ff0000;
            padding: 15px 30px; font-size: 1.5rem; color: yellow; text-align: center;
            border-radius: 10px; display: none; z-index: 100;
            width: 80%; animation: flashAlert 0.5s infinite alternate;
        }
        @keyframes flashAlert { from { opacity: 0.8; } to { opacity: 1; box-shadow: 0 0 20px red; } }

        /* –ü–æ–≤–æ—Ä–æ—Ç —ç–∫—Ä–∞–Ω–∞ */
        #rotate-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999; display: none;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        @media screen and (orientation: portrait) and (max-width: 900px) {
            #rotate-screen { display: flex; }
        }
    </style>
</head>
<body>

    <audio id="sfx-click" src="click.mp3" preload="auto"></audio>
    <audio id="sfx-alarm" src="alarm.mp3" preload="auto"></audio>
    <audio id="sfx-win" src="win.mp3" preload="auto"></audio>
    <audio id="sfx-wrong" src="error.mp3" preload="auto"></audio>

    <div id="rotate-screen">
        <div style="font-size: 3rem; margin-bottom: 20px;">üì±‚û°Ô∏è</div>
        <h2 style="padding: 20px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</h2>
    </div>

    <div id="game-container">
        <video id="mainVideo" playsinline></video>
        <div id="simulation-placeholder">
            <div class="sim-icon">üì°</div>
            <h2 id="sim-text">–ó–ê–ì–†–£–ó–ö–ê –ú–û–î–£–õ–Ø...</h2>
        </div>

        <div id="hud-panel">
            <div class="hud-box">
                üõ°Ô∏è <div id="health-track"><div id="health-fill"></div></div> 
                <span id="health-val">100%</span>
            </div>
            <div class="hud-box">
                üë§ <span id="hud-name" style="margin-right: 10px; color: var(--neon-blue)">GUEST</span>
                üíé <span id="score-val">0</span>
            </div>
        </div>
        
        <div id="alert-popup" class="alert-popup">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –£–ì–†–û–ó–ê!</div>

        <!-- 1. –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù –° –†–ï–ì–ò–°–¢–†–ê–¶–ò–ï–ô -->
        <div id="start-screen" class="overlay">
            <h1>üöÄ –ú–ò–°–°–ò–Ø: –ö–ò–ë–ï–†–©–ò–¢</h1>
            
            <div class="input-group">
                <label class="input-label">–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∏–ª–æ—Ç–∞:</label>
                <input type="text" id="player-name" class="cyber-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è..." maxlength="15">
            </div>

            <button class="btn" onclick="startGame()">‚úÖ –ü–†–ò–°–¢–£–ü–ò–¢–¨ –ö –ú–ò–°–°–ò–ò</button>
            
            <div style="margin-top: 20px; width: 100%; max-width: 600px;">
                <div class="total-counter">
                    <span>–í—Å–µ–≥–æ –∑–∞–ø—É—Å–∫–æ–≤: <b id="total-attempts" style="color:white">0</b></span>
                    <span>–ü–æ–±–µ–¥: <b id="total-wins" style="color:var(--neon-green)">0</b></span>
                </div>
                <div style="text-align: left; color: #888; font-size: 0.8rem; margin-bottom: 5px;">–ü–û–°–õ–ï–î–ù–ò–ï –û–ü–ï–†–ê–¶–ò–ò:</div>
                <div id="leaderboard" class="stats-panel">
                    <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç –∑–∞–ø–∏—Å–∏ -->
                    <div style="text-align: center; color: #555; padding: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                </div>
            </div>
        </div>

        <!-- 2. –û–ë–£–ß–ï–ù–ò–ï -->
        <div id="edu-screen" class="overlay hidden">
            <h1 style="color: #ffcc00">‚ö†Ô∏è –ê–ù–ê–õ–ò–ó –£–ì–†–û–ó–´</h1>
            <div class="edu-card">
                <div class="edu-title">üìÅ –¢–ò–ü: <span id="edu-type-text">...</span></div>
                <div class="edu-text" id="edu-desc-text">...</div>
            </div>
            <button class="btn btn-next" onclick="proceedToChoice()">–ü–†–ò–ù–Ø–¢–¨ –†–ï–®–ï–ù–ò–ï ‚ñ∂</button>
        </div>

        <!-- 3. –í–´–ë–û–† -->
        <div id="ui-choice" class="overlay hidden">
            <h1 id="choice-title" style="color: #fff">–ó–ê–ü–†–û–°</h1>
            <p id="choice-desc" style="font-size: 1.2rem; margin-bottom: 30px; padding: 0 20px;"></p>
            <div id="buttons-container" class="btn-container"></div>
        </div>

        <!-- 4. –†–ï–ó–£–õ–¨–¢–ê–¢ -->
        <div id="feedback-screen" class="overlay hidden">
            <h1 id="fb-title">–†–ï–ó–£–õ–¨–¢–ê–¢</h1>
            <div id="fb-card" class="edu-card">
                <div class="edu-title" id="fb-subtitle"></div>
                <div class="edu-text" id="fb-text"></div>
            </div>
            <button class="btn btn-next" onclick="nextPhase()">–ü–†–û–î–û–õ–ñ–ò–¢–¨ ‚ñ∂</button>
        </div>

        <!-- 5. –§–ò–ù–ê–õ–´ -->
        <div id="game-over-screen" class="overlay hidden" style="background: rgba(50,0,0,0.95)">
            <h1 style="color: #ff3333; font-size: 3rem;">üëæ –ü–†–û–í–ê–õ</h1>
            <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã.</p>
            <p style="color: #888; margin-top: 10px;">–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑–µ.</p>
            <button class="btn btn-danger" onclick="location.reload()">üîÑ –ù–û–í–ê–Ø –ü–û–ü–´–¢–ö–ê</button>
        </div>

        <div id="win-screen" class="overlay hidden" style="background: rgba(0,50,0,0.95)">
            <h1 style="color: #00ff00; font-size: 3rem;">üèÜ –ú–ò–°–°–ò–Ø –£–°–ü–ï–®–ù–ê!</h1>
            <div class="author-badge">
                <p>–ü–∏–ª–æ—Ç: <span id="final-pilot-name">Unknown</span></p>
                <p style="font-size: 1.5rem">–°–ß–ï–¢: <span id="final-score">0</span></p>
            </div>
            <p style="color: #888;">–û—Ç—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —Ü–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
            <button class="btn" onclick="location.reload()">üîÑ –í–ï–†–ù–£–¢–¨–°–Ø –í –®–¢–ê–ë</button>
        </div>
    </div>

    <script>
        // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        const videoPlayer = document.getElementById('mainVideo');
        const simPlaceholder = document.getElementById('simulation-placeholder');
        const simText = document.getElementById('sim-text');
        
        // –≠–∫—Ä–∞–Ω—ã
        const startScreen = document.getElementById('start-screen');
        const eduScreen = document.getElementById('edu-screen');
        const uiChoice = document.getElementById('ui-choice');
        const feedbackScreen = document.getElementById('feedback-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const winScreen = document.getElementById('win-screen');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const hudPanel = document.getElementById('hud-panel');
        const healthFill = document.getElementById('health-fill');
        const healthVal = document.getElementById('health-val');
        const scoreVal = document.getElementById('score-val');
        const alertPopup = document.getElementById('alert-popup');
        const playerNameInput = document.getElementById('player-name');
        const hudName = document.getElementById('hud-name');

        let score = 0;
        let currentHealth = 100;
        let currentPhase = 0; 
        let nextCallback = null;
        let playerName = "–ö—É—Ä—Å–∞–Ω—Ç";

        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const DB_KEY = 'cyberShieldData_v1';

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ---
        function loadStats() {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || { attempts: 0, wins: 0, history: [] };
            
            document.getElementById('total-attempts').innerText = data.attempts;
            document.getElementById('total-wins').innerText = data.wins;

            const list = document.getElementById('leaderboard');
            if (data.history.length > 0) {
                list.innerHTML = '';
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∏–≥—Ä
                data.history.slice().reverse().slice(0, 10).forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'stat-row';
                    const statusClass = item.status === '–ü–û–ë–ï–î–ê' ? 'stat-win' : 'stat-fail';
                    row.innerHTML = `
                        <span>${item.date} | <b>${item.name}</b></span>
                        <span class="${statusClass}">${item.status} (${item.score})</span>
                    `;
                    list.appendChild(row);
                });
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadStats();

        function saveGameResult(status) {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || { attempts: 0, wins: 0, history: [] };
            
            data.attempts++;
            if (status === '–ü–û–ë–ï–î–ê') data.wins++;

            const now = new Date();
            const dateStr = now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes();

            data.history.push({
                name: playerName,
                score: score,
                status: status,
                date: dateStr
            });

            localStorage.setItem(DB_KEY, JSON.stringify(data));
        }

        // --- –ú–ï–î–ò–ê ---
        const videos = {
            intro: 'intro.mp4', phishing: 'phishing.mp4', virus_map: 'virus_map.mp4',
            glitch: 'glitch.mp4', ai_scan: 'ai_scan.mp4', win: 'win.mp4', lose: 'lose.mp4'
        };

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) { sound.currentTime = 0; sound.volume = 0.5; sound.play().catch(()=>{}); }
        }

        function playScenario(videoSrc, simTitle, duration, callback) {
            videoPlayer.style.display = 'block';
            simPlaceholder.style.display = 'none';
            videoPlayer.src = videoSrc;
            const playPromise = videoPlayer.play();
            if (playPromise !== undefined) {
                playPromise.then(() => { videoPlayer.onended = callback; })
                .catch(() => { runSimulation(simTitle, duration, callback); });
            } else { runSimulation(simTitle, duration, callback); }
            videoPlayer.onerror = () => { runSimulation(simTitle, duration, callback); };
        }

        function runSimulation(text, ms, callback) {
            videoPlayer.style.display = 'none';
            simPlaceholder.style.display = 'flex';
            simText.innerText = text;
            setTimeout(callback, ms);
        }

        function updateHUD(healthChange, pointsToAdd) {
            currentHealth += healthChange;
            if(currentHealth > 100) currentHealth = 100;
            if(currentHealth < 0) currentHealth = 0;
            healthFill.style.width = currentHealth + '%';
            healthVal.innerText = currentHealth + '%';
            if(pointsToAdd > 0) {
                score += pointsToAdd;
                scoreVal.innerText = score;
            }
            if (currentHealth < 30) healthFill.style.background = '#ff3333';
            else if (currentHealth < 60) healthFill.style.background = '#ffcc00';
            else healthFill.style.background = '#00ff00';
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
        function startGame() {
            const name = playerNameInput.value.trim();
            if (!name) {
                alert("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–∏–ª–æ—Ç–∞!");
                return;
            }
            playerName = name;
            hudName.innerText = playerName.toUpperCase();
            
            playSound('sfx-click');
            startScreen.classList.add('hidden');
            hudPanel.style.display = 'flex';
            
            playScenario(videos.intro, "–ó–ê–ì–†–£–ó–ö–ê –°–ò–°–¢–ï–ú–´...", 2000, () => {
                playScenario(videos.phishing, "–í–•–û–î–Ø–©–ï–ï –°–û–û–ë–©–ï–ù–ò–ï...", 3000, preparePhishingPhase);
            });
        }

        // –≠–¢–ê–ü 1
        function preparePhishingPhase() {
            showEdu("–§–ò–®–ò–ù–ì (Phishing)", 
                "–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ —Å —Ü–µ–ª—å—é –∫—Ä–∞–∂–∏ –ø–∞—Ä–æ–ª–µ–π.<br>–ü—Ä–∏–∑–Ω–∞–∫–∏: –æ–±–µ—â–∞–Ω–∏–µ –≤—ã–≥–æ–¥—ã, —Å—Ä–æ—á–Ω–æ—Å—Ç—å, —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏.");
        }

        function showEdu(title, text) {
            document.getElementById('edu-type-text').innerText = title;
            document.getElementById('edu-desc-text').innerHTML = text;
            eduScreen.classList.remove('hidden');
        }

        function proceedToChoice() {
            playSound('sfx-click');
            eduScreen.classList.add('hidden');
            
            if (!currentPhase) {
                currentPhase = 1;
                showChoiceUI("üö® –ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê", 
                    "–í –ø–æ—á—Ç–µ –ø–∏—Å—å–º–æ: ¬´–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø—Ä–∏–∑! –ñ–º–∏—Ç–µ —Å—Ä–æ—á–Ω–æ!¬ª",
                    [{ text: "üõ°Ô∏è –£–î–ê–õ–ò–¢–¨", action: () => handleResult(true, "phishing") },
                     { text: "üéÅ –û–¢–ö–†–´–¢–¨", action: () => handleResult(false, "phishing"), style: "btn-danger" }]
                );
            } else if (currentPhase === 2) {
                showChoiceUI("ü§ñ –í–ò–†–£–°-–í–´–ú–û–ì–ê–¢–ï–õ–¨", 
                    "–≠–∫—Ä–∞–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –¢—Ä–µ–±—É—é—Ç –≤—ã–∫—É–ø.",
                    [{ text: "üí∏ –ó–ê–ü–õ–ê–¢–ò–¢–¨", action: () => handleResult(false, "virus"), style: "btn-danger" },
                     { text: "üõ†Ô∏è –õ–ï–ß–ò–¢–¨ –ê–ù–¢–ò–í–ò–†–£–°–û–ú", action: () => handleResult(true, "virus") }]
                );
            }
        }

        function showChoiceUI(title, desc, buttons) {
            document.getElementById('choice-title').innerText = title;
            document.getElementById('choice-desc').innerText = desc;
            const container = document.getElementById('buttons-container');
            container.innerHTML = '';
            buttons.forEach(btn => {
                const b = document.createElement('button');
                b.innerText = btn.text;
                b.className = `btn ${btn.style || ''}`;
                b.onclick = btn.action;
                container.appendChild(b);
            });
            uiChoice.classList.remove('hidden');
        }

        function handleResult(isCorrect, type) {
            playSound('sfx-click');
            uiChoice.classList.add('hidden');
            const fbCard = document.getElementById('fb-card');
            
            if (isCorrect) {
                playSound('sfx-win');
                document.getElementById('fb-title').innerText = "–í–ï–†–ù–û–ï –†–ï–®–ï–ù–ò–ï";
                fbCard.className = "edu-card feedback-correct";
                updateHUD(0, 500);
            } else {
                playSound('sfx-wrong'); playSound('sfx-alarm');
                document.getElementById('fb-title').innerText = "–û–®–ò–ë–ö–ê";
                fbCard.className = "edu-card feedback-wrong";
                updateHUD(-40, 0);
                showAlert("–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–†–û–ù!");
            }

            if (type === "phishing") {
                document.getElementById('fb-subtitle').innerText = isCorrect ? "–£–ì–†–û–ó–ê –û–¢–†–ê–ñ–ï–ù–ê" : "–°–ò–°–¢–ï–ú–ê –í–ó–õ–û–ú–ê–ù–ê";
                document.getElementById('fb-text').innerText = isCorrect 
                    ? "–û—Ç–ª–∏—á–Ω–æ! –°—Å—ã–ª–∫–∏ –æ—Ç –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–µ–≤ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–µ–ª—å–∑—è." 
                    : "–í—ã –ø–µ—Ä–µ—à–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –∑–∞–≥—Ä—É–∑–∏–ª–∏ –≤–∏—Ä—É—Å. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä—å—Ç–µ '–±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –ø—Ä–∏–∑–∞–º'.";
                nextCallback = startVirusPhase;
            } else {
                document.getElementById('fb-subtitle').innerText = isCorrect ? "–õ–ï–ß–ï–ù–ò–ï –£–°–ü–ï–®–ù–û" : "–î–ê–ù–ù–´–ï –ü–û–¢–ï–†–Ø–ù–´";
                document.getElementById('fb-text').innerText = isCorrect 
                    ? "–í–µ—Ä–Ω–æ! –í—ã–∫—É–ø –ø–ª–∞—Ç–∏—Ç—å –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ. –ê–Ω—Ç–∏–≤–∏—Ä—É—Å —Å–ø–∞—Å —Å–∏—Ç—É–∞—Ü–∏—é." 
                    : "–í—ã –∑–∞–ø–ª–∞—Ç–∏–ª–∏, –Ω–æ —Ö–∞–∫–µ—Ä—ã –ø—Ä–æ—Å—Ç–æ –∏—Å—á–µ–∑–ª–∏ —Å –¥–µ–Ω—å–≥–∞–º–∏.";
                nextCallback = isCorrect ? triggerFinalWin : triggerFinalLose;
            }
            feedbackScreen.classList.remove('hidden');
        }

        function nextPhase() {
            playSound('sfx-click');
            feedbackScreen.classList.add('hidden');
            if (nextCallback) nextCallback();
        }

        function startVirusPhase() {
            playScenario(videos.virus_map, "–†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–ï –í–ò–†–£–°–ê...", 2500, () => {
                playScenario(videos.glitch, "–°–ë–û–ô –°–ò–°–¢–ï–ú–´...", 1500, () => {
                    playScenario(videos.ai_scan, "–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï...", 2500, () => {
                        currentPhase = 2;
                        showEdu("RANSOMWARE (–í—ã–º–æ–≥–∞—Ç–µ–ª—å)", "–í–∏—Ä—É—Å, —à–∏—Ñ—Ä—É—é—â–∏–π —Ñ–∞–π–ª—ã. –ó–∞—â–∏—Ç–∞: –±—ç–∫–∞–ø—ã –∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å.");
                    });
                });
            });
        }

        function showAlert(text) {
            alertPopup.innerText = text;
            alertPopup.style.display = 'block';
            setTimeout(() => { alertPopup.style.display = 'none'; }, 2000);
        }

        // --- –§–ò–ù–ê–õ–´ ---
        function triggerFinalWin() {
            playScenario(videos.win, "–°–ò–°–¢–ï–ú–ê –ß–ò–°–¢–ê", 2000, () => {
                playSound('sfx-win');
                document.getElementById('final-score').innerText = score;
                document.getElementById('final-pilot-name').innerText = playerName;
                winScreen.classList.remove('hidden');
                saveGameResult('–ü–û–ë–ï–î–ê');
            });
        }

        function triggerFinalLose() {
            playScenario(videos.lose, "–°–ò–°–¢–ï–ú–ê –£–ù–ò–ß–¢–û–ñ–ï–ù–ê", 2000, () => {
                gameOverScreen.classList.remove('hidden');
                saveGameResult('–ü–†–û–í–ê–õ');
            });
        }
    </script>
</body>
</html>
