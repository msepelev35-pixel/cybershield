<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ú–∏—Å—Å–∏—è: –ö–∏–±–µ—Ä—â–∏—Ç | Rescue Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-green: #0aff0a;
            --neon-red: #ff003c;
            --bg-color: #050505;
            --glass: rgba(12, 20, 35, 0.95);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; background-color: var(--bg-color); color: white;
            font-family: 'Orbitron', sans-serif; overflow: hidden; 
            height: 100dvh; width: 100vw; display: flex;
            align-items: center; justify-content: center; user-select: none;
        }

        #main-wrapper {
            display: flex; width: 100%; height: 100%;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            position: relative; overflow: hidden;
        }

        #game-viewport {
            position: absolute; inset: 0; background: #000;
            overflow: hidden; display: flex; flex-direction: column;
            width: 100%; height: 100%; z-index: 10;
        }
        
        #click-trap {
            position: absolute; inset: 0; z-index: 45; 
            display: none; background: rgba(0,0,0,0.4); 
            backdrop-filter: blur(2px); cursor: pointer;
        }
        #click-trap.active { display: block; }

        video { 
            width: 100%; height: 100%; object-fit: cover; 
            display: none; opacity: 0; transition: opacity 0.5s ease;
            background: #000; transform: translateZ(0); -webkit-transform: translateZ(0);
        }
        video.playing { opacity: 1; display: block; }

        #sim-layer {
            position: absolute; inset: 0; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle at 50% 50%, #001a33 0%, #000 100%);
            z-index: 5; transition: opacity 0.5s;
        }
        #sim-layer.fade-out { opacity: 0; pointer-events: none; }
        
        .radar {
            width: 150px; height: 150px; border: 2px solid rgba(0, 243, 255, 0.4);
            border-radius: 50%; position: relative;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1); margin-bottom: 25px;
        }
        .radar::before {
            content: ''; position: absolute; top: 50%; left: 50%; width: 50%; height: 50%;
            background: linear-gradient(45deg, transparent 50%, rgba(0, 243, 255, 0.8) 100%);
            transform-origin: 0 0; animation: radar-spin 2s linear infinite;
        }
        @keyframes radar-spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }

        #sim-text {
            font-family: 'Share Tech Mono', monospace; font-size: 1.1rem;
            letter-spacing: 3px; color: var(--neon-blue); text-align: center;
            animation: pulse 2s infinite alternate; padding: 0 20px;
        }
        @keyframes pulse { 0% {opacity: 0.4;} 100% {opacity: 1;} }

        #hud {
            position: absolute; top: 0; left: 0; right: 0; padding: 15px;
            display: flex; justify-content: space-between; z-index: 500;
            pointer-events: none; background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
        }
        .hud-left, .hud-right { display: flex; gap: 12px; pointer-events: auto; align-items: center; }
        .hud-item {
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 14px; border-radius: 30px; backdrop-filter: blur(8px); color: #ddd; font-size: 0.8rem;
        }
        .icon-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff;
            cursor: pointer; font-size: 1.4rem; width: 48px; height: 48px;
            display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.2s;
        }
        .icon-btn:active { transform: scale(0.9); background: var(--neon-blue); color: black; }

        #health-bar-container { width: 70px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        #health-bar-fill { width: 100%; height: 100%; background: var(--neon-green); transition: 0.5s; }

        .overlay {
            position: absolute; inset: 0; background: var(--glass); backdrop-filter: blur(15px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; text-align: center; padding: 20px; transition: opacity 0.3s;
        }
        .hidden { opacity: 0; pointer-events: none; }
        
        h1 { font-size: clamp(1.8rem, 5vw, 2.5rem); text-transform: uppercase; margin-bottom: 10px; text-shadow: 0 0 15px var(--neon-blue); }
        .btn {
            background: linear-gradient(90deg, rgba(0,243,255,0.15), transparent);
            color: var(--neon-blue); border: 1px solid var(--neon-blue); border-left: 4px solid var(--neon-blue);
            padding: 16px 32px; font-family: inherit; font-weight: 700; cursor: pointer;
            margin: 10px; border-radius: 4px; text-transform: uppercase; min-width: 220px;
        }

        #side-menu {
            position: absolute; background: rgba(5, 8, 15, 0.98); padding: 20px; 
            z-index: 1000; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: 'Share Tech Mono', monospace; color: var(--neon-blue); overflow-y: auto;
        }
        @media (orientation: portrait) {
            #side-menu { bottom: 0; left: 0; right: 0; height: 35vh; border-top: 2px solid var(--neon-blue); transform: translateY(105%); }
            #side-menu:not(.collapsed) { transform: translateY(0); }
        }
        @media (orientation: landscape) {
            #side-menu { top: 0; left: 0; bottom: 0; width: 320px; border-right: 2px solid var(--neon-blue); transform: translateX(-105%); }
            #side-menu:not(.collapsed) { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <div id="toast" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--neon-blue); color:black; padding:10px 20px; border-radius:20px; font-weight:bold; z-index:5000; opacity:0; transition:0.3s; pointer-events:none; text-transform:uppercase;"></div>

    <div id="main-wrapper">
        <div id="click-trap" onclick="window.UI.toggleLogs()"></div>
        <div id="side-menu" class="collapsed"></div>

        <div id="game-viewport">
            <video id="video-layer" playsinline webkit-playsinline preload="auto" muted></video>
            
            <div id="sim-layer">
                <div class="radar"></div>
                <h2 id="sim-text">–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø...</h2>
            </div>

            <div id="hud" class="hidden">
                <div class="hud-left">
                    <button class="icon-btn" id="btn-fullscreen" onclick="window.UI.toggleFullscreen()">‚õ∂</button>
                    <button class="icon-btn" onclick="window.UI.toggleLogs()">‚ò∞</button>
                    <div class="hud-item">üõ°Ô∏è <div id="health-bar-container"><div id="health-bar-fill"></div></div></div>
                </div>
                <div class="hud-right">
                    <div class="hud-item"><span id="u-name">GUEST</span></div>
                    <div class="hud-item" style="color:var(--neon-blue)">üí† <span id="u-score">0</span></div>
                </div>
            </div>

            <!-- SCREENS -->
            <div id="scr-start" class="overlay">
                <h1>CYBERSHIELD</h1>
                <h2 style="color:var(--neon-blue); font-size: 0.8rem; margin-bottom: 30px; letter-spacing: 5px;">DIAMOND EDITION</h2>
                <input type="text" id="name-in" placeholder="–ò–ú–Ø –ê–ì–ï–ù–¢–ê" maxlength="12" style="background:rgba(255,255,255,0.05); border:1px solid #444; color:white; padding:15px; text-align:center; margin-bottom:20px; width:260px; font-family:inherit; border-radius:5px; outline:none;">
                <button class="btn" onclick="window.Game.start()">üöÄ –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´</button>
                <button class="btn" style="border-color:#444; color:#888;" onclick="window.Stats.show()">üìä –ê–†–•–ò–í</button>
            </div>

            <div id="scr-edu" class="overlay hidden">
                <h1 style="color:#ffcc00">‚ö† –£–ì–†–û–ó–ê</h1>
                <div style="background:rgba(255,255,255,0.05); padding:20px; border-left:4px solid var(--neon-blue); text-align:left; max-width:500px; margin-bottom:20px;">
                    <b id="edu-t" style="color:var(--neon-blue); font-size:1.2rem;"></b><br><br>
                    <span id="edu-d"></span>
                </div>
                <button class="btn" onclick="window.Game.closeEdu()">–ü–†–ò–ù–Ø–¢–û</button>
            </div>

            <div id="scr-choice" class="overlay hidden">
                <h1 id="ch-t">–î–ï–ô–°–¢–í–ò–ï</h1>
                <p id="ch-d" style="margin-bottom:30px; max-width:600px; font-size:1.1rem;"></p>
                <div id="ch-btns" style="display:flex; flex-wrap:wrap; justify-content:center; gap:15px;"></div>
            </div>

            <div id="scr-fb" class="overlay hidden">
                <h1 id="fb-t"></h1>
                <p id="fb-d" style="margin-bottom:30px; max-width:600px; font-size:1.1rem;"></p>
                <button class="btn" onclick="window.Game.next()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
            </div>

            <div id="scr-stats" class="overlay hidden">
                <h1>–ê–†–•–ò–í –ú–ò–°–°–ò–ô</h1>
                <div style="width:100%; max-width:600px; max-height:50vh; overflow-y:auto; background:rgba(0,0,0,0.4); border:1px solid #333; margin:20px 0;">
                    <table style="width:100%; border-collapse:collapse; font-family:'Share Tech Mono'; font-size:0.85rem;">
                        <tbody id="stats-body"></tbody>
                    </table>
                </div>
                <button class="btn" onclick="window.Stats.hide()">–ù–ê–ó–ê–î</button>
            </div>

            <div id="scr-end" class="overlay hidden">
                <h1 id="end-t"></h1>
                <h2 id="end-s" style="font-size:5rem; margin:20px 0; text-shadow:0 0 30px var(--neon-blue);">0</h2>
                <button class="btn" onclick="location.reload()">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
            </div>
        </div>
    </div>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        
        const cfg = { apiKey: "AIzaSyBAKN2b8ZsWpbnTPdgOKIoG_moCAZdR6mc", authDomain: "cybershield-b4422.firebaseapp.com", projectId: "cybershield-b4422", storageBucket: "cybershield-b4422.firebasestorage.app", messagingSenderId: "1048501198341", appId: "1:1048501198341:web:ad9d7f74c145a5a0a3466c" };
        
        let db = null; let auth = null;

        const initDB = async () => {
            try {
                const app = initializeApp(cfg); db = getFirestore(app); auth = getAuth(app);
                await signInAnonymously(auth);
                window.UI.log("–û–±–ª–∞–∫–æ: –û–Ω–ª–∞–π–Ω", "ok");
            } catch(e) { window.UI.log("–û–±–ª–∞–∫–æ: –û—Ñ—Ñ–ª–∞–π–Ω", "warn"); }
        };
        initDB();

        window.Stats = {
            async save(r) {
                const l = JSON.parse(localStorage.getItem('CS_31')) || []; l.push(r); localStorage.setItem('CS_31', JSON.stringify(l));
                if(db && auth.currentUser) {
                    try {
                        const path = collection(db, 'artifacts', 'cybershield-3-1', 'public', 'data', 'mission_results');
                        await addDoc(path, { ...r, ts: Timestamp.now(), uid: auth.currentUser.uid });
                    } catch(e) {}
                }
            },
            async show() {
                const b = document.getElementById('stats-body'); b.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
                document.getElementById('scr-stats').classList.remove('hidden');
                let data = [];
                if(db) {
                    try {
                        const q = query(collection(db, 'artifacts', 'cybershield-3-1', 'public', 'data', 'mission_results'), orderBy("ts", "desc"), limit(12));
                        const s = await getDocs(q); s.forEach(d => data.push(d.data()));
                    } catch(e) {}
                }
                if(!data.length) data = (JSON.parse(localStorage.getItem('CS_31')) || []).reverse();
                b.innerHTML = data.map(r => `<tr style="border-bottom:1px solid #222"><td style="padding:12px">${r.user}</td><td style="color:var(--neon-blue); text-align:center;">${r.score}</td><td style="text-align:right">${r.status}</td></tr>`).join('') || '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π';
            },
            hide() { document.getElementById('scr-stats').classList.add('hidden'); }
        };
    </script>

    <script>
        // --- AUDIO ---
        window.Sound = {
            ctx: null,
            play(type) {
                if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                if(this.ctx.state === 'suspended') this.ctx.resume();
                const now = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.connect(g); g.connect(this.ctx.destination);
                if(type === 'success') { osc.frequency.setValueAtTime(523, now); osc.frequency.exponentialRampToValueAtTime(880, now+0.3); g.gain.setValueAtTime(0.1, now); }
                else if(type === 'error') { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(110, now); g.gain.setValueAtTime(0.1, now); }
                else { osc.frequency.setValueAtTime(800, now); g.gain.setValueAtTime(0.05, now); }
                osc.start(); osc.stop(now+0.4);
            }
        };

        window.UI = {
            toast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 3000); },
            toggleLogs() { window.Sound.play('click'); document.getElementById('side-menu').classList.toggle('collapsed'); document.getElementById('click-trap').classList.toggle('active'); },
            toggleFullscreen() {
                window.Sound.play('click');
                const btn = document.getElementById('btn-fullscreen');
                const isFs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;

                if (!isFs) {
                    const el = document.documentElement;
                    const request = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
                    if (request) {
                        request.call(el).then(() => {
                            this.toast("–†–ï–ñ–ò–ú –ö–ò–ù–û–¢–ê–¢–†–ê: –ü–û–í–ï–†–ù–ò–¢–ï –¢–ï–õ–ï–§–û–ù");
                        }).catch(e => console.log("FS error", e));
                    }
                } else {
                    const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
                    if (exit) exit.call(document);
                }
            },
            syncIcon() {
                const btn = document.getElementById('btn-fullscreen');
                const isFs = document.fullscreenElement || document.webkitFullscreenElement;
                btn.innerHTML = isFs ? "&#10539;" : "&#9974;";
            },
            log(m, type="info") {
                const el = document.getElementById('side-menu');
                const d = document.createElement('div'); d.style.marginBottom = "8px"; d.style.fontSize = "0.75rem";
                d.style.color = type === 'warn' ? 'var(--neon-red)' : (type === 'ok' ? 'var(--neon-green)' : 'var(--neon-blue)');
                d.innerText = `> ${m}`; el.prepend(d);
            }
        };

        document.addEventListener('fullscreenchange', () => window.UI.syncIcon());
        document.addEventListener('webkitfullscreenchange', () => window.UI.syncIcon());

        const STEPS = [
            { type: 'video', src: 'intro.mp4', sim: '–°–í–Ø–ó–¨ –£–°–¢–ê–ù–û–í–õ–ï–ù–ê...', log: '–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã...' },
            { type: 'video', src: 'ai_scan.mp4', sim: '–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï...', log: '–ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π...' },
            { type: 'edu', t: '–§–ò–®–ò–ù–ì', d: '–ü–æ–ø—ã—Ç–∫–∞ –∫—Ä–∞–∂–∏ –ø–∞—Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ —Å–∞–π—Ç—ã. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–≤–æ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö.', log: '–£–≥—Ä–æ–∑–∞: –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è' },
            { type: 'video', src: 'phishing.mp4', sim: '–í–•–û–î–Ø–©–ï–ï –°–û–û–ë–©–ï–ù–ò–ï...', log: '–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å' },
            { type: 'choice', t: '–°–†–û–ß–ù–û–ï –ü–ò–°–¨–ú–û', d: '–ü–∏—Å—å–º–æ: "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤–∑–ª–æ–º–∞–Ω! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è". –ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç–µ?', opts: [
                { t: 'üõ°Ô∏è –£–î–ê–õ–ò–¢–¨', ok: true, f: '–í–µ—Ä–Ω–æ! –≠—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ –∞–∫–∫–∞—É–Ω—Ç–∞.', s: 500 },
                { t: 'üîó –ü–ï–†–ï–ô–¢–ò', ok: false, f: '–û—à–∏–±–∫–∞. –•–∞–∫–µ—Ä –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏–ª –≤–∞—à –ø–∞—Ä–æ–ª—å.', d: 40 }
            ]},
            { type: 'video', src: 'virus_map.mp4', sim: '–¢–†–ï–í–û–ì–ê: –í–ò–†–£–°...', log: '–û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–µ—Ç–µ–≤–æ–π —á–µ—Ä–≤—å' },
            { type: 'video', src: 'glitch.mp4', sim: '–í–ó–õ–û–ú –°–ò–°–¢–ï–ú–´...', log: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—Ä–∞–∂–µ–Ω–∏–µ!' },
            { type: 'choice', t: '–í–´–ú–û–ì–ê–¢–ï–õ–¨', d: '–í—Å–µ —Ñ–∞–π–ª—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã. –•–∞–∫–µ—Ä —Ç—Ä–µ–±—É–µ—Ç 500$ –∑–∞ –∫–ª—é—á. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?', opts: [
                { t: 'üîß –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨', ok: true, f: '–î–∞! –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–ø–∞—Å–ª–∞ –ø—Ä–æ–µ–∫—Ç.', s: 1000 },
                { t: 'üí∏ –ó–ê–ü–õ–ê–¢–ò–¢–¨', ok: false, f: '–ó—Ä—è. –®–∞–Ω—Ç–∞–∂–∏—Å—Ç—ã –æ–±—ã—á–Ω–æ –Ω–µ –ø—Ä–∏—Å—ã–ª–∞—é—Ç –∫–ª—é—á.', d: 60 }
            ]}
        ];

        window.Game = {
            idx: 0, score: 0, hp: 100, name: 'GUEST',
            start() {
                window.Sound.play('click');
                const n = document.getElementById('name-in').value.trim(); if(n) this.name = n;
                document.getElementById('u-name').innerText = this.name;
                document.getElementById('scr-start').classList.add('hidden');
                document.getElementById('hud').classList.remove('hidden');
                
                const v = document.getElementById('video-layer');
                v.muted = false; v.volume = 1.0;
                v.play().then(() => v.pause()).catch(() => {});
                
                this.run();
            },
            run() {
                if(this.idx >= STEPS.length) { this.finish(true); return; }
                const s = STEPS[this.idx];
                if(s.log) window.UI.log(s.log);
                if(s.type === 'video') this.playV(s);
                else if(s.type === 'edu') this.showEdu(s);
                else if(s.type === 'choice') this.showChoice(s);
            },
            playV(s) {
                const v = document.getElementById('video-layer');
                const sim = document.getElementById('sim-layer');
                v.classList.remove('playing'); sim.classList.remove('fade-out');
                document.getElementById('sim-text').innerText = s.sim;
                
                v.src = s.src; v.load();
                v.playbackRate = 1.1;
                
                const onPlay = () => { 
                    v.classList.add('playing'); sim.classList.add('fade-out'); 
                    v.removeEventListener('playing', onPlay); 
                };
                v.addEventListener('playing', onPlay);
                v.play().catch(() => { setTimeout(() => this.next(), 4000); });
                v.onended = () => this.next();
                v.onerror = () => this.next();
            },
            showEdu(s) {
                document.getElementById('edu-t').innerText = s.t;
                document.getElementById('edu-d').innerText = s.d;
                document.getElementById('scr-edu').classList.remove('hidden');
            },
            closeEdu() { window.Sound.play('click'); document.getElementById('scr-edu').classList.add('hidden'); this.next(); },
            showChoice(s) {
                document.getElementById('ch-t').innerText = s.t;
                document.getElementById('ch-d').innerText = s.d;
                const box = document.getElementById('ch-btns'); box.innerHTML = '';
                s.opts.forEach(o => {
                    const b = document.createElement('button'); b.className = 'btn';
                    b.innerText = o.t; b.onclick = () => this.handle(o); box.appendChild(b);
                });
                document.getElementById('scr-choice').classList.remove('hidden');
            },
            handle(o) {
                window.Sound.play(o.ok ? 'success' : 'error');
                document.getElementById('scr-choice').classList.add('hidden');
                if(o.s) this.score += o.s;
                if(o.d) this.hp = Math.max(0, this.hp - o.d);
                document.getElementById('u-score').innerText = this.score;
                document.getElementById('health-bar-fill').style.width = this.hp + '%';
                document.getElementById('fb-t').innerText = o.ok ? '–£–°–ü–ï–•' : '–ü–†–û–í–ê–õ';
                document.getElementById('fb-t').style.color = o.ok ? 'var(--neon-green)' : 'var(--neon-red)';
                document.getElementById('fb-d').innerText = o.f;
                document.getElementById('scr-fb').classList.remove('hidden');
                window.UI.log(o.t, o.ok ? 'ok' : 'warn');
                if(this.hp <= 0) setTimeout(() => this.finish(false), 1500);
            },
            next() { 
                document.getElementById('scr-fb').classList.add('hidden');
                if(this.hp > 0) { this.idx++; this.run(); }
            },
            finish(win) {
                const v = document.getElementById('video-layer');
                const sim = document.getElementById('sim-layer');
                v.src = win ? 'win.mp4' : 'lose.mp4'; v.load();
                v.play().then(() => { v.classList.add('playing'); sim.classList.add('fade-out'); }).catch(() => {});
                v.onended = () => {
                    document.getElementById('end-t').innerText = win ? '–ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê' : '–°–ò–°–¢–ï–ú–ê –í–ó–õ–û–ú–ê–ù–ê';
                    document.getElementById('end-t').style.color = win ? 'var(--neon-green)' : 'var(--neon-red)';
                    document.getElementById('end-s').innerText = this.score;
                    document.getElementById('scr-end').classList.remove('hidden');
                    window.Stats.save({ user: this.name, score: this.score, status: win ? 'WIN' : 'FAIL' });
                };
            }
        };
    </script>
</body>
</html>
